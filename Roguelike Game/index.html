<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>深淵探險者 - Roguelike RPG</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="game-container">
        <!-- 遊戲標題 -->
        <header class="game-header">
            <h1>🗡️ 深淵探險者 🗡️</h1>
            <p class="subtitle">勇敢冒險者，探索無盡地牢的奧秘！</p>
            <button class="music-toggle" id="musicToggle" title="音樂開關">
                🔊
            </button>
        </header>

        <!-- 音樂播放器 -->
        <audio id="bgMusic" loop>
            <source src="music/bgm.mp3" type="audio/mpeg">
            <source src="music/bgm.ogg" type="audio/ogg">
        </audio>

        <!-- 主遊戲區域 -->
        <div class="main-game">
            <!-- 左側：角色資訊 -->
            <aside class="character-panel">
                <div class="panel-header">
                    <h2>⚔️ 角色狀態</h2>
                </div>
                
                <div class="character-info">
                    <div class="character-avatar" id="playerAvatar">🧙</div>
                    <h3 id="playerName">勇者</h3>
                    <div class="level-info">
                        <span>等級: <strong id="playerLevel">1</strong></span>
                        <span>深度: <strong id="dungeonLevel">1</strong></span>
                    </div>
                </div>

                <div class="stats-section">
                    <div class="stat-bar">
                        <div class="stat-label">
                            <span>❤️ 生命值</span>
                            <span id="hpText">100/100</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill hp-fill" id="hpBar" style="width: 100%"></div>
                        </div>
                    </div>

                    <div class="stat-bar">
                        <div class="stat-label">
                            <span>💙 魔力值</span>
                            <span id="mpText">50/50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill mp-fill" id="mpBar" style="width: 100%"></div>
                        </div>
                    </div>

                    <div class="stat-bar">
                        <div class="stat-label">
                            <span>✨ 經驗值</span>
                            <span id="expText">0/100</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill exp-fill" id="expBar" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="stat-grid">
                        <div class="stat-item">
                            <span class="stat-icon">⚔️</span>
                            <span class="stat-name">攻擊</span>
                            <span class="stat-value" id="playerAttack">10</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">🛡️</span>
                            <span class="stat-name">防禦</span>
                            <span class="stat-value" id="playerDefense">5</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">💰</span>
                            <span class="stat-name">金幣</span>
                            <span class="stat-value" id="playerGold">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-icon">🔥</span>
                            <span class="stat-name">暴擊率</span>
                            <span class="stat-value" id="playerCrit">10%</span>
                        </div>
                    </div>
                </div>

                <div class="equipment-section">
                    <h3>🎒 裝備</h3>
                    <div class="equipment-slots">
                        <div class="equipment-slot" id="weaponSlot">
                            <div class="slot-icon">⚔️</div>
                            <div class="slot-name">武器</div>
                        </div>
                        <div class="equipment-slot" id="armorSlot">
                            <div class="slot-icon">🛡️</div>
                            <div class="slot-name">護甲</div>
                        </div>
                        <div class="equipment-slot" id="accessorySlot">
                            <div class="slot-icon">💍</div>
                            <div class="slot-name">飾品</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- 中間：地牢視圖 -->
            <section class="dungeon-view">
                <div class="dungeon-controls">
                    <button class="btn btn-primary" id="newGameBtn">🎮 新遊戲</button>
                    <button class="btn btn-success" id="nextLevelBtn" disabled>⬇️ 下一層</button>
                    <button class="btn btn-info" id="healBtn">💊 治療 (30金)</button>
                    <button class="btn btn-warning" id="skillTreeBtn" onclick="openSkillTree()">📖 技能樹</button>
                </div>

                <div class="dungeon-grid" id="dungeonGrid">
                    <!-- 地牢格子將由 JavaScript 生成 -->
                </div>

                <!-- 移動端虛擬方向鍵 -->
                <div class="virtual-dpad" id="virtualDpad">
                    <div class="dpad-row">
                        <button class="dpad-btn dpad-empty"></button>
                        <button class="dpad-btn" data-direction="up">⬆️</button>
                        <button class="dpad-btn dpad-empty"></button>
                    </div>
                    <div class="dpad-row">
                        <button class="dpad-btn" data-direction="left">⬅️</button>
                        <button class="dpad-btn dpad-center">🎮</button>
                        <button class="dpad-btn" data-direction="right">➡️</button>
                    </div>
                    <div class="dpad-row">
                        <button class="dpad-btn dpad-empty"></button>
                        <button class="dpad-btn" data-direction="down">⬇️</button>
                        <button class="dpad-btn dpad-empty"></button>
                    </div>
                </div>

                <div class="controls-help">
                    <h4>🎮 操作說明</h4>
                    <p>點擊相鄰格子移動 | WASD 或方向鍵移動</p>
                    <p>📜 自動撿取物品 | ⚔️ 碰觸敵人戰鬥</p>
                </div>
            </section>

            <!-- 右側：事件日誌與背包 -->
            <aside class="info-panel">
                <div class="panel-header">
                    <h2>📜 遊戲日誌</h2>
                </div>
                <div class="game-log" id="gameLog">
                    <div class="log-entry welcome">歡迎來到深淵探險者！</div>
                    <div class="log-entry info">點擊「新遊戲」開始冒險...</div>
                </div>

                <div class="panel-header">
                    <h2>🎒 背包</h2>
                    <button class="btn btn-warning btn-small" id="sellModeBtn">💰 賣出模式</button>
                </div>
                <div class="inventory" id="inventory">
                    <div class="empty-inventory">背包是空的</div>
                </div>
            </aside>
        </div>

        <!-- 戰鬥模態框 -->
        <div class="modal" id="battleModal">
            <div class="modal-content battle-modal">
                <h2>⚔️ 戰鬥開始！</h2>
                <div class="battle-arena">
                    <div class="battle-character player-side">
                        <div class="battle-avatar">🧙</div>
                        <h3>勇者</h3>
                        <div class="battle-hp">
                            <div class="progress-bar">
                                <div class="progress-fill hp-fill" id="battlePlayerHp" style="width: 100%"></div>
                            </div>
                            <span id="battlePlayerHpText">100/100</span>
                        </div>
                    </div>

                    <div class="battle-vs">VS</div>

                    <div class="battle-character enemy-side">
                        <div class="battle-avatar" id="enemyAvatar">👹</div>
                        <h3 id="enemyName">哥布林</h3>
                        <div class="battle-hp">
                            <div class="progress-bar">
                                <div class="progress-fill hp-fill enemy-hp" id="battleEnemyHp" style="width: 100%"></div>
                            </div>
                            <span id="battleEnemyHpText">50/50</span>
                        </div>
                    </div>
                </div>

                <div class="battle-log" id="battleLog">
                    <div class="battle-message">戰鬥日誌將顯示在這裡...</div>
                </div>

                <div class="battle-actions">
                    <button class="btn btn-danger btn-large" id="attackBtn">⚔️ 攻擊</button>
                    <button class="btn btn-warning btn-large" id="defendBtn">🛡️ 防禦</button>
                    <button class="btn btn-secondary btn-large" id="fleeBtn">🏃 逃跑</button>
                </div>

                <!-- 技能欄 -->
                <div class="battle-skills" id="battleSkills">
                    <!-- 動態生成裝備的技能按鈕 -->
                </div>
            </div>
        </div>

        <!-- 遊戲結束模態框 -->
        <div class="modal" id="gameOverModal">
            <div class="modal-content">
                <h2 id="gameOverTitle">💀 遊戲結束</h2>
                <div class="game-over-stats">
                    <p>最終等級: <strong id="finalLevel">1</strong></p>
                    <p>探索深度: <strong id="finalDepth">1</strong></p>
                    <p>擊殺敵人: <strong id="finalKills">0</strong></p>
                    <p>收集金幣: <strong id="finalGold">0</strong></p>
                </div>
                <button class="btn btn-primary btn-large" id="restartBtn">🔄 重新開始</button>
            </div>
        </div>

        <!-- 開場劇情模態框 -->
        <div class="modal" id="prologueModal" style="display: flex;">
            <div class="modal-content prologue-modal">
                <h2>📜 深淵的呼喚 📜</h2>
                <div class="prologue-content">
                    <div class="prologue-chapter">
                        <p class="prologue-text">
                            在世界的盡頭，有一座被遺忘的古老地牢——<strong class="highlight">永恆深淵</strong>。
                        </p>
                        <p class="prologue-text">
                            傳說中，這座地牢曾是遠古文明的神殿，埋藏著足以改變世界的力量與寶藏。
                            無數冒險者前仆後繼地深入其中，卻再也沒有人能活著返回地面。
                        </p>
                    </div>
                    
                    <div class="prologue-chapter">
                        <p class="prologue-text">
                            直到有一天，你所在的村莊突然出現了詭異的異象——
                            天空開始變暗，大地微微顫抖，遠方的深淵中傳來陣陣低沉的咆哮聲。
                        </p>
                        <p class="prologue-text">
                            村中的長老翻閱古老典籍後驚恐地發現：<strong class="highlight">深淵之主正在甦醒</strong>！
                            如果不盡快阻止，整個世界都將被黑暗吞噬。
                        </p>
                    </div>
                    
                    <div class="prologue-chapter">
                        <p class="prologue-text">
                            在絕望之際，你挺身而出。也許是命運的指引，也許是內心的呼喚，
                            你決定踏上這條充滿未知的征途。
                        </p>
                        <p class="prologue-text final-words">
                            ⚔️ <em>拿起武器，勇敢的冒險者</em> ⚔️<br>
                            <em>深入黑暗，揭開真相，拯救世界於水火之中！</em>
                        </p>
                    </div>
                </div>
                <button class="btn btn-primary btn-large" id="startAdventureBtn">
                    ✨ 開始冒險 ✨
                </button>
            </div>
        </div>

        <!-- 新手教學模態框 -->
        <div class="modal" id="tutorialModal" style="display: none;">
            <div class="modal-content tutorial-modal">
                <h2>📚 冒險者指南 📚</h2>
                <p class="tutorial-subtitle">在踏入深淵之前，先了解冒險的基本知識</p>
                
                <div class="tutorial-content">
                    <!-- 移動與探索 -->
                    <div class="tutorial-section">
                        <div class="tutorial-icon">🎮</div>
                        <h3>移動與探索</h3>
                        <div class="tutorial-details">
                            <p>• <strong>電腦操作：</strong>使用 WASD 或方向鍵移動角色</p>
                            <p>• <strong>手機操作：</strong>點擊相鄰格子或使用虛擬方向鍵</p>
                            <p>• <strong>目標：</strong>找到樓梯 🎯 進入下一層地牢</p>
                        </div>
                    </div>

                    <!-- 戰鬥系統 -->
                    <div class="tutorial-section">
                        <div class="tutorial-icon">⚔️</div>
                        <h3>戰鬥系統</h3>
                        <div class="tutorial-details">
                            <p>• <strong>遭遇敵人：</strong>移動到敵人位置自動開始戰鬥</p>
                            <p>• <strong>戰鬥選項：</strong>攻擊、防禦、使用技能或逃跑</p>
                            <p>• <strong>技能消耗：</strong>使用技能需要消耗魔力值（MP）</p>
                            <p>• <strong>獲得獎勵：</strong>擊敗敵人獲得經驗值、金幣和裝備</p>
                        </div>
                    </div>

                    <!-- 角色成長 -->
                    <div class="tutorial-section">
                        <div class="tutorial-icon">📈</div>
                        <h3>角色成長</h3>
                        <div class="tutorial-details">
                            <p>• <strong>等級提升：</strong>累積經驗值可以升級，提升基礎屬性</p>
                            <p>• <strong>技能點數：</strong>每次升級獲得 1 點技能點，用於學習技能</p>
                            <p>• <strong>職業進階：</strong>10 級和 30 級時可以進階到更強職業</p>
                            <p>• <strong>技能樹：</strong>點擊左側「技能樹」按鈕學習新技能</p>
                        </div>
                    </div>

                    <!-- 物品系統 -->
                    <div class="tutorial-section">
                        <div class="tutorial-icon">🎒</div>
                        <h3>物品與裝備</h3>
                        <div class="tutorial-details">
                            <p>• <strong>撿取物品：</strong>移動到物品位置自動撿取</p>
                            <p>• <strong>裝備管理：</strong>點擊背包中的裝備可以穿戴</p>
                            <p>• <strong>使用藥水：</strong>點擊消耗品立即使用恢復生命或魔力</p>
                            <p>• <strong>賣出物品：</strong>點擊「賣出模式」可以出售物品換取金幣</p>
                        </div>
                    </div>

                    <!-- 生存技巧 -->
                    <div class="tutorial-section">
                        <div class="tutorial-icon">💡</div>
                        <h3>生存技巧</h3>
                        <div class="tutorial-details">
                            <p>• <strong>量力而行：</strong>遇到強敵可以選擇逃跑，保存實力</p>
                            <p>• <strong>資源管理：</strong>合理使用藥水和技能，避免浪費魔力</p>
                            <p>• <strong>裝備優先：</strong>優先裝備高品質裝備提升戰鬥力</p>
                            <p>• <strong>謹慎前進：</strong>生命值過低時使用治療或返回城鎮</p>
                        </div>
                    </div>
                </div>

                <div class="tutorial-footer">
                    <button class="btn btn-primary btn-large" id="tutorialNextBtn">
                        ✨ 我準備好了！選擇職業 ✨
                    </button>
                    <button class="btn btn-secondary btn-small" id="skipTutorialBtn">
                        跳過教學
                    </button>
                </div>
            </div>
        </div>

        <!-- 職業選擇模態框 -->
        <div class="modal" id="classSelectModal" style="display: none;">
            <div class="modal-content class-select-modal">
                <h2>🎭 選擇你的職業</h2>
                <p class="class-select-subtitle">選擇一個職業開始你的冒險旅程</p>
                
                <div class="class-grid">
                    <!-- 戰士 -->
                    <div class="class-card" data-class="warrior">
                        <div class="class-icon">⚔️</div>
                        <h3>戰士</h3>
                        <div class="class-stats">
                            <p>❤️ 生命: <strong>120</strong></p>
                            <p>💙 魔力: <strong>30</strong></p>
                            <p>⚔️ 攻擊: <strong>15</strong></p>
                            <p>🛡️ 防禦: <strong>8</strong></p>
                        </div>
                        <p class="class-description">強壯的近戰專家，擁有高生命值和防禦力</p>
                        <div class="class-skill">
                            <strong>技能：</strong>狂暴打擊（15魔力） - 造成200%傷害
                        </div>
                    </div>

                    <!-- 法師 -->
                    <div class="class-card" data-class="mage">
                        <div class="class-icon">🔮</div>
                        <h3>法師</h3>
                        <div class="class-stats">
                            <p>❤️ 生命: <strong>80</strong></p>
                            <p>💙 魔力: <strong>100</strong></p>
                            <p>⚔️ 攻擊: <strong>18</strong></p>
                            <p>🛡️ 防禦: <strong>3</strong></p>
                        </div>
                        <p class="class-description">操控元素的魔法使用者，擁有高攻擊力和魔力</p>
                        <div class="class-skill">
                            <strong>技能：</strong>火球術（20魔力） - 造成250%魔法傷害
                        </div>
                    </div>

                    <!-- 牧師 -->
                    <div class="class-card" data-class="priest">
                        <div class="class-icon">✨</div>
                        <h3>牧師</h3>
                        <div class="class-stats">
                            <p>❤️ 生命: <strong>100</strong></p>
                            <p>💙 魔力: <strong>80</strong></p>
                            <p>⚔️ 攻擊: <strong>10</strong></p>
                            <p>🛡️ 防禦: <strong>6</strong></p>
                        </div>
                        <p class="class-description">神聖力量的使者，擁有治療和輔助能力</p>
                        <div class="class-skill">
                            <strong>技能：</strong>神聖治療（25魔力） - 恢復40%生命值
                        </div>
                    </div>

                    <!-- 盜賊 -->
                    <div class="class-card" data-class="rogue">
                        <div class="class-icon">🗡️</div>
                        <h3>盜賊</h3>
                        <div class="class-stats">
                            <p>❤️ 生命: <strong>90</strong></p>
                            <p>💙 魔力: <strong>50</strong></p>
                            <p>⚔️ 攻擊: <strong>14</strong></p>
                            <p>🛡️ 防禦: <strong>5</strong></p>
                        </div>
                        <p class="class-description">敏捷的刺客，擁有高暴擊率和閃避能力</p>
                        <div class="class-skill">
                            <strong>技能：</strong>致命一擊（18魔力） - 必定暴擊300%傷害
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 轉職模態框 -->
        <div class="modal" id="jobChangeModal">
            <div class="modal-content job-change-modal">
                <h2>🎊 職業進階</h2>
                <p class="job-change-subtitle" id="jobChangeText">恭喜達到 10 級！選擇你的進階職業</p>
                
                <div class="job-grid" id="jobOptions">
                    <!-- 動態生成進階職業選項 -->
                </div>
            </div>
        </div>

        <!-- 技能樹模態框 -->
        <div class="modal" id="skillTreeModal">
            <div class="modal-content skill-tree-modal">
                <div class="modal-header">
                    <h2>📖 技能樹</h2>
                    <button class="btn-close" onclick="closeSkillTree()">✕</button>
                </div>
                <div class="skill-points-info">
                    <span>剩餘技能點數：</span>
                    <strong id="skillPointsDisplay">0</strong>
                </div>
                <div class="skill-tree-container" id="skillTreeContainer">
                    <!-- 動態生成技能卡片 -->
                </div>
                <div class="skill-tree-help">
                    <p>💡 提示：每次升級獲得1點技能點，可用來學習或升級技能。學習後的技能會自動在戰鬥中顯示。</p>
                </div>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>
